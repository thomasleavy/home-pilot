import{a as j}from"./chunk-5T2BYJ45.js";import{a as z}from"./chunk-66TX2GSC.js";import{b as A}from"./chunk-FKSBLCNH.js";import{$ as x,B as l,E as w,I as v,K as E,N as f,O as I,P as _,R as k,S as P,T as o,U as a,V as O,W as D,X as h,Y as c,Z as s,_ as g,a as m,aa as M,b as p,da as y,ea as L,fa as F,ka as U,la as $,ma as V,q as S,s as C,t as b,u as T,va as H}from"./chunk-UDG4TZWI.js";var G=(n,e)=>e.deviceId,W=(n,e)=>e.timestamp+e.deviceId;function N(n,e){if(n&1&&(o(0,"div",1),s(1),a()),n&2){let t=c();l(),x(" ",t.error," ")}}function q(n,e){n&1&&(o(0,"p",2),s(1,"Loading devices\u2026"),a())}function J(n,e){if(n&1&&(o(0,"li",18)(1,"span",19),s(2),y(3,"date"),a(),o(4,"span",20),s(5),a()()),n&2){let t=e.$implicit;l(2),g(F(3,2,t.timestamp,"shortTime")),l(3),g(t.message)}}function Q(n,e){if(n&1&&(o(0,"section",13)(1,"h2",4),s(2,"Alerts"),a(),o(3,"ul",17),k(4,J,6,5,"li",18,W),a()()),n&2){let t=c(2);l(4),P(t.alerts.slice(0,5))}}function K(n,e){n&1&&(o(0,"span",25),s(1,"\u{1F4A1}"),a())}function X(n,e){n&1&&(o(0,"span",26),s(1,"\u{1F321}"),a())}function Y(n,e){n&1&&(o(0,"span",25),s(1,"\u{1F441}"),a())}function Z(n,e){n&1&&(o(0,"span",27),T(),o(1,"svg",37),O(2,"path",38)(3,"path",39)(4,"path",40),a()())}function tt(n,e){n&1&&(o(0,"span",25),s(1,"\u25A2"),a())}function et(n,e){if(n&1&&(o(0,"span",30),s(1),a()),n&2){let t=c().$implicit,i=c(2);l(),g(i.getLightOn(t)?"On":"Off")}}function nt(n,e){if(n&1&&(o(0,"span",30),s(1),a(),o(2,"span",31),s(3),a(),o(4,"span",41),s(5),a()),n&2){let t=c().$implicit,i=c(2);l(),M("",i.getThermostatTemp(t),"",i.preferredUnit==="F"?"\xB0F":"\xB0C",""),l(2),M("Heating to ",i.getThermostatSetpoint(t),"",i.preferredUnit==="F"?"\xB0F":"\xB0C",""),l(2),g(i.getThermostatHeatingOn(t)?"Heating on":"Heating off")}}function it(n,e){if(n&1&&(o(0,"span",31),s(1),a()),n&2){let t=c().$implicit,i=c(2);l(),x("Last motion ",i.getMotionTime(t),"")}}function ot(n,e){if(n&1&&(o(0,"span",30),s(1),a()),n&2){let t=c().$implicit,i=c(2);l(),g(i.getLightOn(t)?"On":"Off")}}function at(n,e){if(n&1&&(o(0,"span",30),s(1),y(2,"json"),a()),n&2){let t=c().$implicit;l(),g(L(2,1,t.state))}}function rt(n,e){if(n&1){let t=D();o(0,"button",42),h("click",function(){C(t);let r=c().$implicit,d=c(2);return b(d.toggleLight(r.deviceId,d.getLightOn(r)))}),s(1),a()}if(n&2){let t=c().$implicit,i=c(2);f("on",i.getLightOn(t)),l(),x(" ",i.getLightOn(t)?"On":"Off"," ")}}function st(n,e){if(n&1){let t=D();o(0,"div",34)(1,"button",43),h("click",function(){C(t);let r=c().$implicit,d=c(2);return b(d.setThermostatHeating(r.deviceId,!d.getThermostatHeatingOn(r)))}),s(2),a(),o(3,"button",44),h("click",function(){C(t);let r=c().$implicit,d=c(2);return b(d.stepThermostatSetpoint(r.deviceId,r,-1))}),s(4,"\u2212"),a(),o(5,"button",44),h("click",function(){C(t);let r=c().$implicit,d=c(2);return b(d.stepThermostatSetpoint(r.deviceId,r,1))}),s(6,"+"),a()()}if(n&2){let t=c().$implicit,i=c(2);l(),f("on",i.getThermostatHeatingOn(t)),l(),x(" ",i.getThermostatHeatingOn(t)?"On":"Off"," ")}}function ct(n,e){if(n&1){let t=D();o(0,"button",42),h("click",function(){C(t);let r=c().$implicit,d=c(2);return b(d.toggleHotWater(r.deviceId,d.getLightOn(r)))}),s(1),a()}if(n&2){let t=c().$implicit,i=c(2);f("on",i.getLightOn(t)),l(),x(" ",i.getLightOn(t)?"On":"Off"," ")}}function lt(n,e){}function dt(n,e){n&1&&(O(0,"span",45),s(1," Connected "))}function mt(n,e){n&1&&(O(0,"span",46),s(1," Poor connection "))}function pt(n,e){if(n&1&&(O(0,"span",47),s(1)),n&2){let t=c(3);l(),x(" ",t.connectionLabel()," ")}}function _t(n,e){if(n&1&&(o(0,"article",21)(1,"div",22)(2,"div",23)(3,"span",24),v(4,K,2,0,"span",25)(5,X,2,0,"span",26)(6,Y,2,0,"span",25)(7,Z,5,0,"span",27)(8,tt,2,0,"span",25),a(),o(9,"div",28)(10,"h3",29),s(11),a(),v(12,et,2,1,"span",30)(13,nt,6,5)(14,it,2,1,"span",31)(15,ot,2,1,"span",30)(16,at,3,3,"span",30),a()(),o(17,"div",32),v(18,rt,2,3,"button",33)(19,st,7,3,"div",34)(20,ct,2,3,"button",33)(21,lt,0,0),a()(),o(22,"div",35)(23,"span",36),v(24,dt,2,0)(25,mt,2,0)(26,pt,2,1),a()()()),n&2){let t,i,r,d=e.$implicit,u=c(2);I("device-"+d.type),l(3),E("aria-hidden",!0),l(),_((t=d.type)==="light"?4:t==="thermostat"?5:t==="motion"?6:t==="hot-water"?7:8),l(7),g(d.name),l(),_((i=d.type)==="light"?12:i==="thermostat"?13:i==="motion"?14:i==="hot-water"?15:16),l(6),_((r=d.type)==="light"?18:r==="thermostat"?19:r==="hot-water"?20:21),l(5),f("poor",u.connectionStatus==="poor"||u.connectionStatus==="disconnected"),l(),_(u.connectionStatus==="connected"?24:u.connectionStatus==="poor"||u.connectionStatus==="disconnected"?25:26)}}function gt(n,e){if(n&1&&(v(0,Q,6,0,"section",13),o(1,"section",14)(2,"h2",4),s(3,"Devices"),a(),o(4,"div",15),k(5,_t,27,10,"article",16,G),a()()),n&2){let t=c();_(t.alerts.length?0:-1),l(5),P(t.devices)}}var ut={deviceId:"hot-water-1",type:"hot-water",name:"Hot Water",state:{on:!1},lastUpdated:new Date().toISOString()},vt={deviceId:"living-room-light",type:"light",name:"Living Room Light",state:{on:!1},lastUpdated:new Date().toISOString()},B=class n{api=S(A);auth=S(z);tempUnit=S(j);devices=[];alerts=[];loading=!0;error=null;connectionStatus="disconnected";preferredUnit="C";ngOnInit(){this.tempUnit.refresh(),this.preferredUnit=this.tempUnit.getPreferredUnit(),this.tempUnit.preferredUnit$.subscribe(e=>this.preferredUnit=e),this.api.connectionStatus$.subscribe(e=>this.connectionStatus=e),this.api.devices$.subscribe(e=>this.devices=this.ensurePlaceholderDevicesInList(e)),this.api.alerts$.subscribe(e=>this.alerts.unshift(e)),this.api.getDevices().subscribe({next:e=>{this.api.setDevices(e),this.loading=!1},error:e=>{this.error="Cannot reach backend. Start the backend (see README).",this.loading=!1}}),this.api.getAlerts().subscribe({next:e=>this.alerts=e??[]})}ngOnDestroy(){}toggleLight(e,t){let i=!t;this.api.setDeviceStateOverlay(e,{on:i}),this.devices=this.devices.map(r=>r.deviceId===e?p(m({},r),{state:p(m({},r.state),{on:i})}):r),this.api.sendCommand(e,{on:i}).subscribe()}toggleHotWater(e,t){let i=!t;this.api.setDeviceStateOverlay(e,{on:i}),this.devices=this.ensurePlaceholderDevicesInList(this.devices),this.devices=this.devices.map(r=>r.deviceId===e?p(m({},r),{state:p(m({},r.state),{on:i})}):r),this.api.sendCommand(e,{on:i}).subscribe()}ensurePlaceholderDevicesInList(e){let t=e;if(!t.some(i=>i.deviceId==="living-room-light")){let r={on:this.api.getDeviceOverlay("living-room-light").on??!1};t=[...t,p(m({},vt),{state:r,lastUpdated:new Date().toISOString()})]}if(!t.some(i=>i.deviceId==="hot-water-1")){let r={on:this.api.getDeviceOverlay("hot-water-1").on??!1};t=[...t,p(m({},ut),{state:r,lastUpdated:new Date().toISOString()})]}return t}setThermostat(e,t){this.api.sendCommand(e,{setpoint:t}).subscribe()}stepThermostatSetpoint(e,t,i){let r=this.getThermostatSetpoint(t),u=this.tempUnit.toDisplay(r)+i,R=this.tempUnit.toCelsius(u);this.setThermostat(e,R)}setThermostatHeating(e,t){this.api.setDeviceStateOverlay(e,{heatingOn:t}),this.devices=this.devices.map(i=>i.deviceId===e?p(m({},i),{state:p(m({},i.state),{heatingOn:t})}):i),this.api.sendCommand(e,{heatingOn:t}).subscribe()}getLightOn(e){return e.state.on??!1}getThermostatTemp(e){let t=e.state.temperature??0;return this.tempUnit.toDisplay(t)}getThermostatSetpoint(e){let t=e.state.setpoint??20;return this.tempUnit.toDisplay(t)}getThermostatHeatingOn(e){return e.state.heatingOn??!0}getMotionTime(e){let t=e.state.timestamp;return t?new Date(t).toLocaleTimeString():"\u2014"}connectionLabel(){switch(this.connectionStatus){case"connected":return"Connected";case"connecting":return"Connecting\u2026";case"poor":return"Poor connection";default:return"Disconnected"}}onLogout(){this.auth.logout()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=w({type:n,selectors:[["app-dashboard"]],decls:29,vars:3,consts:[[1,"content"],[1,"error-banner"],[1,"loading"],[1,"support-section"],[1,"section-title"],[1,"options-list"],["routerLink","/ask-ai",1,"option-link","option-link-nav"],["routerLink","/faq",1,"option-link","option-link-nav"],["routerLink","/guide",1,"option-link","option-link-nav"],[1,"app-section"],["routerLink","/text-size",1,"option-link","option-link-nav"],["routerLink","/about",1,"option-link","option-link-nav"],["type","button",1,"logout-btn",3,"click"],[1,"alerts-section"],[1,"devices-section"],[1,"device-list"],[1,"device-card",3,"class"],[1,"alert-list"],[1,"alert-item"],[1,"alert-time"],[1,"alert-message"],[1,"device-card"],[1,"card-main"],[1,"card-left"],[1,"device-icon"],[1,"icon-symbol"],[1,"icon-symbol","icon-thermostat"],["aria-hidden","true",1,"icon-symbol","icon-tap"],[1,"device-info"],[1,"device-name"],[1,"device-value"],[1,"device-meta"],[1,"card-right"],["type","button",1,"btn-toggle",3,"on"],[1,"thermostat-controls"],[1,"card-footer"],[1,"connection-status"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M8 20V9a4 4 0 0 1 8 0v11"],["d","M4 16h16"],["d","M6 12h12"],[1,"device-meta","heating-status"],["type","button",1,"btn-toggle",3,"click"],["type","button",1,"btn-toggle","heating-toggle",3,"click"],["type","button",1,"btn-boost",3,"click"],[1,"status-dot","status-ok"],[1,"status-dot","status-poor"],[1,"status-dot","status-connecting"]],template:function(t,i){t&1&&(o(0,"main",0),v(1,N,2,1,"div",1)(2,q,2,0,"p",2)(3,gt,7,1),o(4,"section",3)(5,"h2",4),s(6,"Support"),a(),o(7,"ul",5)(8,"li")(9,"a",6),s(10,"Ask"),a()(),o(11,"li")(12,"a",7),s(13,"FAQ"),a()(),o(14,"li")(15,"a",8),s(16,"Guide"),a()()()(),o(17,"section",9)(18,"h2",4),s(19,"App"),a(),o(20,"ul",5)(21,"li")(22,"a",10),s(23,"Text size"),a()(),o(24,"li")(25,"a",11),s(26,"About"),a()()()(),o(27,"button",12),h("click",function(){return i.onLogout()}),s(28,"Log out"),a()()),t&2&&(l(),_(i.error?1:-1),l(),_(i.loading&&!i.error?2:-1),l(),_(!i.loading&&!i.error?3:-1))},dependencies:[V,$,U,H],styles:[".content[_ngcontent-%COMP%]{flex:1;padding:1.25rem 1.25rem 5rem}.error-banner[_ngcontent-%COMP%]{background:var(--error-bg);color:var(--error-red);padding:.75rem 1rem;border-radius:12px;margin-bottom:1rem;font-size:.9rem}.loading[_ngcontent-%COMP%]{color:var(--text-secondary);margin:1rem 0}.section-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--text-primary);margin:0 0 .75rem}.alerts-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.alert-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;background:var(--bg-card);border-radius:12px;box-shadow:var(--shadow);overflow:hidden;transition:background-color .2s ease,box-shadow .2s ease}.alert-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;font-size:.9rem;border-bottom:1px solid var(--border)}.alert-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.alert-time[_ngcontent-%COMP%]{color:var(--text-secondary);flex-shrink:0}.alert-message[_ngcontent-%COMP%]{flex:1;color:var(--text-primary)}.device-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.device-card[_ngcontent-%COMP%]{background:var(--bg-card);border-radius:16px;padding:1.25rem;box-shadow:var(--shadow);border:1px solid var(--border);transition:background-color .2s ease,border-color .2s ease,box-shadow .2s ease}.card-main[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:1rem}.card-left[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem;min-width:0}.device-icon[_ngcontent-%COMP%]{flex-shrink:0;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:12px;background:var(--accent-orange-soft)}.device-light[_ngcontent-%COMP%]   .device-icon[_ngcontent-%COMP%]{background:var(--icon-light-bg)}.device-thermostat[_ngcontent-%COMP%]   .device-icon[_ngcontent-%COMP%]{background:var(--accent-orange-soft)}.device-motion[_ngcontent-%COMP%]   .device-icon[_ngcontent-%COMP%], .device-hot-water[_ngcontent-%COMP%]   .device-icon[_ngcontent-%COMP%]{background:var(--accent-blue-soft)}.icon-tap[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.icon-tap[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:1.25rem;height:1.25rem}.icon-symbol[_ngcontent-%COMP%]{font-size:1.25rem}.device-info[_ngcontent-%COMP%]{min-width:0}.device-name[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--text-primary);margin:0 0 .25rem}.device-value[_ngcontent-%COMP%]{display:block;font-size:1.25rem;font-weight:600;color:var(--text-primary)}.device-meta[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-secondary)}.heating-status[_ngcontent-%COMP%]{display:block;margin-top:.15rem}.card-right[_ngcontent-%COMP%]{flex-shrink:0}.btn-toggle[_ngcontent-%COMP%]{padding:.5rem 1rem;border-radius:10px;border:1px solid var(--border);background:var(--bg-content);color:var(--text-primary);font-size:.9rem;font-weight:500;cursor:pointer;min-width:56px;transition:background .2s ease,border-color .2s ease,color .2s ease}.btn-toggle.on[_ngcontent-%COMP%]{background:var(--accent-orange-soft);border-color:var(--accent-orange);color:var(--accent-orange)}.thermostat-controls[_ngcontent-%COMP%]{display:flex;gap:.5rem}.btn-boost[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;border:1px solid var(--border);background:var(--accent-blue-soft);color:var(--accent-blue);font-size:1.25rem;line-height:1;cursor:pointer;display:flex;align-items:center;justify-content:center}.btn-boost[_ngcontent-%COMP%]:hover{filter:brightness(1.15)}.card-footer[_ngcontent-%COMP%]{margin-top:.75rem;padding-top:.75rem;border-top:1px solid var(--border)}.connection-status[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-secondary);display:flex;align-items:center;gap:.35rem}.connection-status.poor[_ngcontent-%COMP%]{color:var(--status-poor)}.status-dot[_ngcontent-%COMP%]{width:6px;height:6px;border-radius:50%}.status-ok[_ngcontent-%COMP%]{background:var(--status-ok)}.status-poor[_ngcontent-%COMP%]{background:var(--status-poor)}.status-connecting[_ngcontent-%COMP%]{background:var(--status-connecting)}.support-section[_ngcontent-%COMP%], .app-section[_ngcontent-%COMP%]{margin-top:1.5rem}.options-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;background:var(--bg-card);border-radius:12px;box-shadow:var(--shadow);overflow:hidden;border:1px solid var(--border)}.options-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{border-bottom:1px solid var(--border)}.options-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}.option-link[_ngcontent-%COMP%]{display:block;padding:.75rem 1rem;color:var(--text-primary);text-decoration:none;font-size:.95rem;transition:background .2s ease,color .2s ease}.option-link[_ngcontent-%COMP%]:hover{background:var(--bg-content)}.option-link-nav[_ngcontent-%COMP%]{color:var(--accent-blue)}.logout-btn[_ngcontent-%COMP%]{display:block;width:100%;margin-top:1.5rem;padding:.875rem 1rem;border:none;border-radius:12px;background:#dc2626;color:#fff;font-size:1rem;font-weight:500;cursor:pointer;transition:background .2s ease}.logout-btn[_ngcontent-%COMP%]:hover{background:#b91c1c}"]})};export{B as DashboardComponent};

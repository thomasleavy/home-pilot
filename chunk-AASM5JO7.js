import{a as g,b as h}from"./chunk-LB3TK5W2.js";import{k as i,n as p,q as s,ra as c,xa as u}from"./chunk-NXQ7BON5.js";var n="mqtt-device-pilot.token",a="mqtt-device-pilot.user",v=class o{http=s(c);router=s(u);deviceApi=s(h);baseUrl=g.apiUrl;getToken(){return localStorage.getItem(n)}isLoggedIn(){return!!this.getToken()}getCurrentUser(){try{let e=localStorage.getItem(a);return e?JSON.parse(e):null}catch{return null}}getUsername(){return this.getCurrentUser()?.username??""}register(e,t,r){return this.http.post(`${this.baseUrl}/api/auth/register`,{username:e,email:t,password:r}).pipe(i(l=>{this.saveSession(l.token,l.user),this.deviceApi.connectWebSocket()}))}login(e,t){return this.http.post(`${this.baseUrl}/api/auth/login`,{login:e,password:t}).pipe(i(r=>{this.saveSession(r.token,r.user),this.deviceApi.connectWebSocket()}))}logout(){localStorage.removeItem(n),localStorage.removeItem(a),localStorage.removeItem("mqtt-device-pilot.deviceStateOverlay"),this.deviceApi.disconnectWebSocket(),this.router.navigate(["/welcome"])}getProfile(){return this.http.get(`${this.baseUrl}/api/auth/me`)}updateProfile(e){return this.http.patch(`${this.baseUrl}/api/auth/profile`,e).pipe(i(t=>this.saveSession(t.token,t.user)))}changePassword(e,t){return this.http.post(`${this.baseUrl}/api/auth/change-password`,{currentPassword:e,newPassword:t})}deleteAccount(){return this.http.delete(`${this.baseUrl}/api/auth/account`)}saveSession(e,t){localStorage.setItem(n,e),localStorage.setItem(a,JSON.stringify(t)),localStorage.removeItem("mqtt-device-pilot.deviceStateOverlay")}static \u0275fac=function(t){return new(t||o)};static \u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"})};export{v as a};

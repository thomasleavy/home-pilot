import{b as H}from"./chunk-LB3TK5W2.js";import{B as o,E as C,I as p,L as _,M as x,P as m,R as h,S as g,T as r,U as a,V as y,Y as l,aa as s,ba as d,pa as b,q as v,ya as D}from"./chunk-NXQ7BON5.js";var u=(n,t)=>t.date;function O(n,t){if(n&1&&(r(0,"div",3),s(1),a()),n&2){let e=l();o(),d(e.error)}}function I(n,t){n&1&&(r(0,"p",4),s(1,"Loading\u2026"),a())}function S(n,t){if(n&1&&(r(0,"div",10),y(1,"div",13),r(2,"span",14),s(3),a()()),n&2){let e=t.$implicit,i=l(3);o(),x("height",i.heatingBarHeight(e.minutesOn),"%"),_("title",i.formatDuration(e.minutesOn)),o(2),d(i.formatDuration(e.minutesOn))}}function w(n,t){if(n&1&&(r(0,"span",12),s(1),a()),n&2){let e=t.$implicit,i=l(3);o(),d(i.formatDate(e.date))}}function P(n,t){if(n&1&&(r(0,"div",8)(1,"div",9),h(2,S,4,4,"div",10,u),a(),r(4,"div",11),h(5,w,2,1,"span",12,u),a()()),n&2){let e=l(2);o(2),g(e.heatingHistory),o(3),g(e.heatingHistory)}}function E(n,t){if(n&1&&(r(0,"div",10),y(1,"div",15),r(2,"span",14),s(3),a()()),n&2){let e=t.$implicit,i=l(3);o(),x("height",i.hotWaterBarHeight(e.minutesOn),"%"),_("title",i.formatDuration(e.minutesOn)),o(2),d(i.formatDuration(e.minutesOn))}}function T(n,t){if(n&1&&(r(0,"span",12),s(1),a()),n&2){let e=t.$implicit,i=l(3);o(),d(i.formatDate(e.date))}}function k(n,t){if(n&1&&(r(0,"div",8)(1,"div",9),h(2,E,4,4,"div",10,u),a(),r(4,"div",11),h(5,T,2,1,"span",12,u),a()()),n&2){let e=l(2);o(2),g(e.hotWaterHistory),o(3),g(e.hotWaterHistory)}}function W(n,t){if(n&1&&(r(0,"section",6)(1,"h2",7),s(2,"Heating history"),a(),p(3,P,7,0,"div",8),a(),r(4,"section",6)(5,"h2",7),s(6,"Hot water history"),a(),p(7,k,7,0,"div",8),a()),n&2){let e=l();o(3),m(e.heatingHistory.length?3:-1),o(4),m(e.hotWaterHistory.length?7:-1)}}var $=5e3,M=class n{api=v(H);refreshTimer=null;heatingHistory=[];hotWaterHistory=[];loading=!0;error=null;heatingDone=!1;hotWaterDone=!1;ngOnInit(){this.loadHistory(),this.refreshTimer=setInterval(()=>this.loadHistory(),$)}ngOnDestroy(){this.refreshTimer&&clearInterval(this.refreshTimer)}loadHistory(){this.api.getHeatingHistory().subscribe({next:t=>{this.heatingHistory=t,this.heatingDone=!0,this.error=null,this.hotWaterDone&&(this.loading=!1)},error:()=>{this.heatingHistory.length===0&&(this.heatingHistory=this.emptyHistory()),this.heatingDone=!0,this.error="Cannot load insights. Is the backend running at http://localhost:3000?",this.hotWaterDone&&(this.loading=!1)}}),this.api.getHotWaterHistory().subscribe({next:t=>{this.hotWaterHistory=t,this.hotWaterDone=!0,this.error=null,this.heatingDone&&(this.loading=!1)},error:()=>{this.hotWaterHistory.length===0&&(this.hotWaterHistory=this.emptyHistory()),this.hotWaterDone=!0,this.error="Cannot load insights. Is the backend running at http://localhost:3000?",this.heatingDone&&(this.loading=!1)}})}formatDate(t){let e=new Date(t+"T12:00:00"),i=new Date,c=this.localDateKey(i);if(t===c)return"Today";let f=new Date(i);return f.setDate(f.getDate()-1),t===this.localDateKey(f)?"Yesterday":e.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})}localDateKey(t){let e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getDate()).padStart(2,"0");return`${e}-${i}-${c}`}emptyHistory(){let t=[],e=new Date;for(let i=6;i>=0;i--){let c=new Date(e);c.setDate(c.getDate()-i),t.push({date:this.localDateKey(c),minutesOn:0})}return t}maxMinutesScale=24*60;heatingBarHeight(t){let e=t/this.maxMinutesScale*100;return Math.min(100,Math.round(e*10)/10)}hotWaterBarHeight(t){let e=t/this.maxMinutesScale*100;return Math.min(100,Math.round(e*10)/10)}formatDuration(t){if(t<60)return`${t} min`;let e=Math.floor(t/60),i=Math.round(t%60);return i===0?`${e} hr`:`${e} hr ${i} min`}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=C({type:n,selectors:[["app-insights"]],decls:10,vars:3,consts:[[1,"insights-page"],[1,"page-title"],[1,"page-intro"],[1,"error-banner"],[1,"loading"],["routerLink","/home",1,"back-link"],[1,"chart-section"],[1,"chart-title"],[1,"chart-container"],[1,"chart-bars"],[1,"bar-wrapper"],[1,"chart-labels"],[1,"bar-label"],[1,"bar","bar-heating",3,"title"],[1,"bar-value"],[1,"bar","bar-hot-water",3,"title"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"h1",1),s(2,"Insights"),a(),r(3,"p",2),s(4,"Cumulative time on for the past 7 days."),a(),p(5,O,2,1,"div",3)(6,I,2,0,"p",4)(7,W,8,2),r(8,"a",5),s(9,"\u2190 Back to Home"),a()()),e&2&&(o(5),m(i.error?5:-1),o(),m(i.loading&&!i.heatingHistory.length&&!i.hotWaterHistory.length?6:-1),o(),m(i.loading?-1:7))},dependencies:[b,D],styles:[".insights-page[_ngcontent-%COMP%]{padding:1.5rem 1.25rem 5rem;max-width:480px;margin:0 auto}.page-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin:0 0 .5rem}.page-intro[_ngcontent-%COMP%]{color:var(--text-secondary);margin:0 0 1.5rem;font-size:.95rem}.error-banner[_ngcontent-%COMP%]{background:var(--error-bg);color:var(--error-red);padding:.75rem 1rem;border-radius:12px;margin-bottom:1rem}.loading[_ngcontent-%COMP%]{color:var(--text-secondary);margin:1rem 0}.chart-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.chart-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--text-primary);margin:0 0 .75rem}.chart-container[_ngcontent-%COMP%]{background:var(--bg-card);border-radius:16px;padding:1.25rem;border:1px solid var(--border);box-shadow:var(--shadow)}.chart-bars[_ngcontent-%COMP%], .chart-labels[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;gap:.5rem}.chart-bars[_ngcontent-%COMP%]{height:140px;align-items:flex-end;margin-bottom:.5rem;overflow:hidden}.bar-wrapper[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;min-width:0;height:100%;overflow:hidden}.bar[_ngcontent-%COMP%]{width:100%;max-width:36px;min-height:4px;max-height:100%;border-radius:6px 6px 0 0;transition:height .3s ease;flex-shrink:0}.bar-heating[_ngcontent-%COMP%]{background:var(--accent-orange)}.bar-hot-water[_ngcontent-%COMP%]{background:var(--accent-blue)}.bar-value[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary);margin-top:.25rem}.bar-label[_ngcontent-%COMP%]{flex:1;font-size:.7rem;color:var(--text-secondary);text-align:center;min-width:0}.back-link[_ngcontent-%COMP%]{color:var(--accent-blue);text-decoration:none;font-size:.95rem}.back-link[_ngcontent-%COMP%]:hover{text-decoration:underline}"]})};export{M as InsightsComponent};

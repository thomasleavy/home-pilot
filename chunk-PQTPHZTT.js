import{a as F,b as u,c as M,d as O,e as k,g as D,h as V,n as T,o as z}from"./chunk-5G5EFX5T.js";import{a as E}from"./chunk-AASM5JO7.js";import"./chunk-LB3TK5W2.js";import{B as l,E as P,I as c,L as _,P as m,T as t,U as e,V as h,W as C,X as b,Y as p,aa as o,ba as f,ca as v,pa as y,q as x,s as g,t as w,ya as S}from"./chunk-NXQ7BON5.js";function I(r,i){r&1&&(t(0,"p",3),o(1,"Loading\u2026"),e())}function G(r,i){if(r&1&&(t(0,"div",4),o(1),e()),r&2){let n=p(2);l(),f(n.profileError)}}function L(r,i){r&1&&(t(0,"span",13),o(1,"Valid email required"),e())}function U(r,i){r&1&&(t(0,"p",15),o(1,"Profile updated."),e())}function q(r,i){if(r&1){let n=C();t(0,"button",25),b("click",function(){g(n);let d=p(2);return w(d.togglePasswordForm())}),o(1,"Change password"),e()}}function A(r,i){r&1&&(t(0,"span",13),o(1,"At least 6 characters"),e())}function R(r,i){if(r&1&&(t(0,"p",33),o(1),e()),r&2){let n=p(3);l(),f(n.passwordError)}}function Y(r,i){r&1&&(t(0,"p",15),o(1,"Password changed."),e())}function B(r,i){if(r&1){let n=C();t(0,"form",26),b("ngSubmit",function(){g(n);let d=p(2);return w(d.changePassword())}),t(1,"label",27),o(2,"Current password"),e(),h(3,"input",28),t(4,"label",29),o(5,"New password"),e(),h(6,"input",30),c(7,A,2,0,"span",13),t(8,"label",31),o(9,"Confirm new password"),e(),h(10,"input",32),c(11,R,2,1,"p",33)(12,Y,2,0,"p",15),t(13,"div",34)(14,"button",35),b("click",function(){g(n);let d=p(2);return w(d.togglePasswordForm())}),o(15,"Cancel"),e(),t(16,"button",14),o(17),e()()()}if(r&2){let n,a=p(2);_("formGroup",a.passwordForm),l(7),m((n=a.passwordForm.get("newPassword"))!=null&&n.invalid&&((n=a.passwordForm.get("newPassword"))!=null&&n.touched)?7:-1),l(4),m(a.passwordError?11:-1),l(),m(a.passwordSuccess?12:-1),l(4),_("disabled",a.passwordForm.invalid||a.passwordLoading),l(),v(" ",a.passwordLoading?"Updating\u2026":"Update password"," ")}}function j(r,i){if(r&1){let n=C();c(0,G,2,1,"div",4),t(1,"section",5)(2,"h2",6),o(3,"Profile"),e(),t(4,"form",7),b("ngSubmit",function(){g(n);let d=p();return w(d.saveProfile())}),t(5,"label",8),o(6,"Username"),e(),t(7,"p",9),o(8),e(),t(9,"p",10),o(10,"Your username cannot be changed."),e(),t(11,"label",11),o(12,"Email"),e(),h(13,"input",12),c(14,L,2,0,"span",13),t(15,"button",14),o(16,"Save changes"),e(),c(17,U,2,0,"p",15),e()(),t(18,"section",16)(19,"h2",17),o(20,"Account ID"),e(),t(21,"p",18),o(22),e(),t(23,"p",10),o(24,"Your unique account identifier. Used to link your devices and data to your profile."),e()(),t(25,"section",19)(26,"h2",20),o(27,"Password"),e(),t(28,"p",21),o(29),e(),t(30,"p",10),o(31,"Your password is stored securely and never shown. Use the button below to change it."),e(),c(32,q,2,0,"button",22)(33,B,18,6,"form",23),e(),t(34,"a",24),o(35,"\u2190 Back to Manage"),e()}if(r&2){let n,a,d,s=p();m(s.profileError?0:-1),l(4),_("formGroup",s.profileForm),l(4),f((n=s.profile==null?null:s.profile.username)!==null&&n!==void 0?n:"\u2014"),l(6),m((a=s.profileForm.get("email"))!=null&&a.invalid&&((a=s.profileForm.get("email"))!=null&&a.touched)?14:-1),l(),_("disabled",s.profileForm.invalid||s.profileForm.pristine),l(2),m(s.profileSaved?17:-1),l(5),f((d=s.profile==null?null:s.profile.id)!==null&&d!==void 0?d:"\u2014"),l(7),f(s.passwordPlaceholder),l(3),m(s.showPasswordForm?33:32)}}var N=class r{auth=x(E);fb=x(T);profileForm;passwordForm;profile=null;loading=!0;profileError="";profileSaved=!1;showPasswordForm=!1;passwordError="";passwordSuccess=!1;passwordLoading=!1;passwordPlaceholder="\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022";ngOnInit(){this.profileForm=this.fb.group({email:["",[u.required,u.email]]}),this.passwordForm=this.fb.group({currentPassword:["",u.required],newPassword:["",[u.required,u.minLength(6)]],confirmPassword:["",u.required]}),this.auth.getProfile().subscribe({next:i=>{this.profile=i,this.profileForm.patchValue({email:i.email}),this.loading=!1},error:()=>{this.profileError="Could not load profile.",this.profile=this.auth.getCurrentUser(),this.profile&&this.profileForm.patchValue({email:this.profile.email}),this.loading=!1}})}saveProfile(){this.profileError="",this.profileSaved=!1;let i=this.profileForm.getRawValue();this.profileForm.invalid||!i.email?.trim()||this.auth.updateProfile({email:i.email.trim()}).subscribe({next:n=>{this.profile=n.user,this.profileSaved=!0,setTimeout(()=>this.profileSaved=!1,3e3)},error:n=>{this.profileError=n.error?.error??"Update failed. Username or email may already be in use."}})}togglePasswordForm(){this.showPasswordForm=!this.showPasswordForm,this.passwordForm.reset(),this.passwordError="",this.passwordSuccess=!1}changePassword(){this.passwordError="",this.passwordSuccess=!1;let i=this.passwordForm.getRawValue();if(this.passwordForm.invalid||i.newPassword!==i.confirmPassword){this.passwordError=i.newPassword!==i.confirmPassword?"New passwords do not match.":"Please fill all fields; new password must be at least 6 characters.";return}this.passwordLoading=!0,this.auth.changePassword(i.currentPassword,i.newPassword).subscribe({next:()=>{this.passwordSuccess=!0,this.passwordForm.reset(),this.showPasswordForm=!1,this.passwordLoading=!1,setTimeout(()=>this.passwordSuccess=!1,3e3)},error:n=>{this.passwordError=n.error?.error??"Failed to change password.",this.passwordLoading=!1}})}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=P({type:r,selectors:[["app-personal-details"]],decls:7,vars:1,consts:[[1,"personal-details-page"],[1,"page-title"],[1,"page-intro"],[1,"loading"],["role","alert",1,"error-banner"],["aria-labelledby","profile-heading",1,"details-card"],["id","profile-heading",1,"section-heading"],[3,"ngSubmit","formGroup"],["for","username",1,"label"],["id","username",1,"readonly-value"],[1,"readonly-description"],["for","email",1,"label"],["id","email","type","email","formControlName","email","placeholder","Email","autocomplete","email",1,"input"],[1,"hint"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"save-hint"],["aria-labelledby","account-id-heading",1,"details-card"],["id","account-id-heading",1,"section-heading"],[1,"readonly-value"],["aria-labelledby","password-heading",1,"details-card"],["id","password-heading",1,"section-heading"],[1,"password-masked"],["type","button",1,"btn","btn-secondary"],[1,"password-form",3,"formGroup"],["routerLink","/manage",1,"back-link"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"password-form",3,"ngSubmit","formGroup"],["for","currentPassword",1,"label"],["id","currentPassword","type","password","formControlName","currentPassword","placeholder","Current password","autocomplete","current-password",1,"input"],["for","newPassword",1,"label"],["id","newPassword","type","password","formControlName","newPassword","placeholder","New password (min 6 characters)","autocomplete","new-password",1,"input"],["for","confirmPassword",1,"label"],["id","confirmPassword","type","password","formControlName","confirmPassword","placeholder","Confirm new password","autocomplete","new-password",1,"input"],["role","alert",1,"hint"],[1,"password-actions"],["type","button",1,"btn","btn-link",3,"click"]],template:function(n,a){n&1&&(t(0,"div",0)(1,"h1",1),o(2,"Personal details"),e(),t(3,"p",2),o(4,"Your account information. This is unique to your profile."),e(),c(5,I,2,0,"p",3)(6,j,36,9),e()),n&2&&(l(5),m(a.loading?5:6))},dependencies:[y,S,z,k,F,M,O,D,V],styles:[".personal-details-page[_ngcontent-%COMP%]{padding:1.5rem 1.25rem 5rem;max-width:560px;margin:0 auto}.page-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin:0 0 .5rem}.page-intro[_ngcontent-%COMP%]{color:var(--text-secondary);margin:0 0 1.5rem;font-size:.95rem;line-height:1.5}.loading[_ngcontent-%COMP%]{color:var(--text-secondary);margin:0 0 1rem}.error-banner[_ngcontent-%COMP%]{background:var(--error-bg);color:var(--error-red);padding:.75rem 1rem;border-radius:12px;margin-bottom:1rem;font-size:.9rem}.details-card[_ngcontent-%COMP%]{background:var(--bg-card);border-radius:16px;border:1px solid var(--border);box-shadow:var(--shadow);padding:1.25rem 1.25rem 1.5rem;margin-bottom:1.5rem}.section-heading[_ngcontent-%COMP%]{font-size:1.05rem;font-weight:600;color:var(--text-primary);margin:0 0 .75rem;line-height:1.35}.label[_ngcontent-%COMP%]{display:block;font-size:.9rem;font-weight:500;color:var(--text-primary);margin-bottom:.25rem}.input[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;margin-bottom:.75rem;border:1px solid var(--border);border-radius:10px;font-size:1rem;background:var(--bg-content);color:var(--text-primary);box-sizing:border-box}.input[_ngcontent-%COMP%]::placeholder{color:var(--text-secondary)}.hint[_ngcontent-%COMP%]{display:block;font-size:.8rem;color:var(--error-red);margin-bottom:.5rem}.readonly-value[_ngcontent-%COMP%]{font-size:1rem;color:var(--text-primary);margin:0 0 .5rem;font-family:ui-monospace,monospace}.readonly-description[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-secondary);line-height:1.5;margin:0 0 .75rem}.password-masked[_ngcontent-%COMP%]{font-size:1rem;color:var(--text-secondary);letter-spacing:.15em;margin:0 0 .5rem}.password-form[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-top:.5rem}.password-form[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]:first-of-type{margin-top:0}.password-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:center;margin-top:1rem}.btn[_ngcontent-%COMP%]{padding:.75rem 1rem;border:none;border-radius:10px;font-size:.95rem;font-weight:600;cursor:pointer}.btn-primary[_ngcontent-%COMP%]{background:var(--accent-blue);color:#fff;margin-top:.25rem}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){opacity:.9}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{background:var(--bg-content);color:var(--text-primary);border:1px solid var(--border)}.btn-secondary[_ngcontent-%COMP%]:hover{background:var(--border)}.btn-link[_ngcontent-%COMP%]{background:transparent;color:var(--accent-blue);font-weight:500}.btn-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.save-hint[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-secondary);margin:.5rem 0 0}.back-link[_ngcontent-%COMP%]{display:inline-block;color:var(--accent-blue);text-decoration:none;font-size:.95rem}.back-link[_ngcontent-%COMP%]:hover{text-decoration:underline}"]})};export{N as PersonalDetailsComponent};
